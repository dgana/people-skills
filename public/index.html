<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>People Skills</title>
  </head>
  <!--Import Google Icon Font-->
  <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
  <link rel="stylesheet" href="css/style.css">
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <body>
    <nav class="teal lighten-1" role="navigation">
      <div class="nav-wrapper container"><a id="logo-container" href="#" class="brand-logo">ODM Mongo DB AJAX</a>
        <ul class="right hide-on-med-and-down">
          <li><a href="#">Home</a></li>
        </ul>

        <ul id="nav-mobile" class="side-nav">
          <li><a href="#">Home</a></li>
        </ul>
        <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
      </div>
    </nav>

    <!-- Modal Structure -->
    <div id="modal" class="modal modal-fixed-footer">
      <form id="input_new_user">
        <div class="modal-content">
          <div class="row">
            <div class="col s12">
              <div class="row">
                <div class="input-field col s12">
                  <input placeholder="Input your full name" id="full_name" type="text" class="validate">
                  <label for="full_name">Full Name</label>
                </div>
              </div>
              <div class="row">
                <div class="" id="person_skill">
                  <div class="input-field col s6">
                    <input name="skill_0" type="text" class="validate" placeholder="What is your skill?">
                    <label for="skills">Skills</label>
                  </div>
                  <div class="input-field col s6">
                    <select name="value_0">
                      <option value="" disabled selected>Skill Level</option>
                      <option value="25">Beginner</option>
                      <option value="50">Amateur</option>
                      <option value="75">Advanced</option>
                      <option value="100">Professional</option>
                    </select>
                  </div>
                </div>
                <div class="row col s12">
                  <button class="waves-effect waves-light btn" id="button_person_skill"><i class="material-icons left">input</i>Add More Skill</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
      <div class="modal-footer">
        <button class="waves-effect waves-light btn" type="submit"><i class="material-icons left">input</i>Submit</button>
      </div>
    </div>

    <div class="container" style="margin-top: 25px;">
      <div class="section">
        <div class="row">
          <h3 class="header left teal-text">People Skills</h3>
        </div>

        <div class="row">
          <a href="#modal" class="waves-effect waves-light btn"><i class="material-icons left">input</i>Add a Person</a>
        </div>

        <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Skills</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody id="table_content"></tbody>
      </table>
      </div>
    </div>

  <!--Import jQuery before materialize.js-->
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <!-- Compiled and minified JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>
  <script src="js/init.js"></script>
  <script>
    let index = 1;
    $('#button_person_skill').click(function(e) {
      e.preventDefault()

      let arr = ['','Second', 'Third', 'Fourth', 'Fifth', 'Sixth', 'Seventh', 'Eighth', 'Ninth', 'Tenth'];
      $('#person_skill').append(
        `
          <div class="input-field col s6">
            <input name="skill_${index}" type="text" class="validate" placeholder="Enter your ${arr[index]} Skill">
          </div>
          <div class="input-field col s6">
            <select name="value_${index}">
              <option value="" disabled selected>Skill Level</option>
              <option value="25">Beginner</option>
              <option value="50">Amateur</option>
              <option value="75">Advanced</option>
              <option value="100">Professional</option>
            </select>
          </div>
        `
      )
      $(`select[name=value_${index}]`).material_select()
      index++
    })

    $.ajax({
      type: 'GET',
      url: 'http://localhost:3000/api',
      dataType: 'json',
      success: (user) => {
        let iterateUserData = (i, resultUserData) => {
          resultUserData = $('#table_content').append(
            `
            <tr>
              <td>${user[i].name}</td>
              <td id="assign_skill_${i}"></td>
              <td id="assign_value_${i}"></td>
            </tr>
            `
          )
          return resultUserData
        }
        let iterateSkills = (i, resultSkills) => {
          for(let k = 0; k < user[i].skills.length; k++) {
            resultSkills = $('#assign_value_'+i).append(
              `
              <p>${user[i].skills[k].value}</p>
              `
            )
          }
          return resultSkills
        }

        let iterateValue = (i, resultValues) => {
          for(let j = 0; j < user[i].skills.length; j++) {
            resultValue = $('#assign_skill_'+i).append(
              `
              <p>${user[i].skills[j].skill}</p>
              `
            )
          }
          return resultValues
        }

        for(let i = 0; i < user.length; i++) {
          iterateUserData(i)
          iterateSkills(i)
          iterateValue(i)
        }
      }
    })
  </script>
  </body>
</html>
